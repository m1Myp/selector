# Selector

**Selector** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –≤–æ –≤–∑–≤–µ—à–µ–Ω–Ω—É—é —Å—É–º–º—É –ø—Ä–æ—Ñ–∏–ª–µ–π —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤. –ü–æ—Å—Ç—Ä–æ–µ–Ω –≤ –≤–∏–¥–µ –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤.

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
selector/
‚îú‚îÄ‚îÄ stage1/find_files.py    # –ü–æ–∏—Å–∫ –∏ —Å–∏—Å—Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∏—Å—Ö–æ–¥–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π
‚îú‚îÄ‚îÄ stage2/build_histo.py   # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (–≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã), –∫–æ–º–ø—Ä–µ—Å—Å–∏—è
‚îú‚îÄ‚îÄ stage3/solve_math.py    # –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ —Ä–∞–∑–ª–æ–∂–µ–Ω–∏—è –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
‚îî‚îÄ‚îÄ stage4/postprocess.py   # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone http://gitlab.sberlab.nsu.ru/ilmat192/selector.git
cd selector
export TOOL_DIR=$(pwd)
pip install -r requirements.txt
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
export WORK_DIR=".../path/to/artifacts"     # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –∫—É–¥–∞ –º—ã —Å–∫–ª–∞–¥—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
export REFERENCE_DIR="...path/to/reference" # –í–Ω—É—Ç—Ä–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω –ø—Ä–æ—Ñ–∏–ª—å, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–ª–µ–≤—ã–º (—à–∞–≥ 1)
export SAMPLE_DIR="...path/to/samples"      # –í—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∫—Ä–æ–º–µ —Ü–µ–ª–µ–≤—ã—Ö —Å—á–∏—Ç–∞—é—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—è–º–∏ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ (—à–∞–≥ 1)
export LOOKUP_MASK="*.jfr"                  # –ú–∞—Å–∫–∞ –∏–¥–µ–Ω—Ç–µ—Ñ–µ—Ü–∏—Ä—É—é—â–∞—è –ø—Ä–æ—Ñ–∏–ª—å (—à–∞–≥ 1)
export COMPRESSION_MODE="default"           # –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ (—à–∞–≥ 2)
export MIN_SIMILARITY=90                    # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–ª–µ–≤–∞—è –ø–æ—Ö–æ–∂–µ—Å—Ç—å (—à–∞–≥ 3)
export MAX_SELECTED_TRACES=5                # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ (—à–∞–≥ 3)
export OUTPUT_FOLDER_NAME="default"         # –†–µ–∂–∏–º –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø–∞–ø–æ–∫ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã (—à–∞–≥ 4)
```

### 3. –í—ã–ø–æ–ª–Ω–∏ —à–∞–≥–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞ –ø–æ –æ—á–µ—Ä–µ–¥–∏

```bash
python $TOOL_DIR/stage1/find_files.py  --sample-dir=$SAMPLE_DIR --reference-dir=$REFERENCE_DIR --work-dir=$WORK_DIR --lookup-mask=$LOOKUP_MASK
python $TOOL_DIR/stage2/build_histo.py --compression-mode=$COMPRESSION_MODE --work-dir=$WORK_DIR --lookup-mask=$LOOKUP_MASK 
python $TOOL_DIR/stage3/solve_math.py  --min-similarity=$MIN_SIMILARITY --max-selected-traces=$MAX_SELECTED_TRACES --work-dir=$WORK_DIR
python $TOOL_DIR/stage4/postprocess.py --output-folder-name=$OUTPUT_FOLDER_NAME --work-dir=$WORK_DIR
```

## üîç –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø?

### üîπ –≠—Ç–∞–ø 1: `find_files.py`
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–π –º–∞—Å–∫–µ `$LOOKUP_MASK` –∏–ª–∏ –ª—é–±—ã–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º (–Ω–∞–ø—Ä–∏–º–µ—Ä `.histop`). –û–Ω –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∏—Ö –∫–∞–∫ reference –∏–ª–∏ sample –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ JSON.
–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON –Ω–∞ –≤—ã—Ö–æ–¥–µ:
```json
{
  "type": "reference" | "sample",
  "source_file": "/–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.jfr"
}
```
–°–∫—Ä–∏–ø—Ç —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç reference —Ñ–∞–π–ª, –∑–∞—Ç–µ–º –Ω–∞—Ö–æ–¥–∏—Ç sample —Ñ–∞–π–ª—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ —Ñ–∞–π–ª `${WORK_DIR}/stages/stage1/input_0000.json`.
–§–∞–π–ª—ã –ø–æ–ª—É—á–∞—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –æ—Ç `0000` –¥–æ `9999`, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.

### üîπ –≠—Ç–∞–ø 2: `build_histo.py`
–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ—Ñ–∏–ª—è –≤ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã. 
–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –º–æ–∂–Ω–æ —Å–∂–∏–º–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–≥–æ –∫–ª—é—á–∞ `--compression-mode`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —Ä–µ–∂–∏–º—ã:

| –†–µ–∂–∏–º             | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
|-------------------|--------------------------------------------------------------------------|
| `default`         | –ë–µ–∑ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ JFR.                          |
| `compress_97`     | –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ 97% —Å–∞–º—ã—Ö "–≥–æ—Ä—è—á–∏—Ö" (—á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º—ã—Ö) —Ñ—É–Ω–∫—Ü–∏–π.       |
| `compress_same`   | –°–∂–∏–º–∞—é—Ç—Å—è –∏–¥—É—â–∏–µ –ø–æ–¥—Ä—è–¥ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∫–æ–ª-–≤–æ–º –≤—ã–∑–æ–≤–æ–≤ –≤ –æ–¥–Ω—É.    |
| `both`            | –ü—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –æ–±–∞ –≤–∏–¥–∞ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏: `compress_97` –∏ `compress_same`.        |

> üí° –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `--compression-mode=default`.

#### –§–æ—Ä–º–∞—Ç –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º

–°–∫—Ä–∏–ø—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–≤–æ–¥ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ—Ñ–∏–ª–µ–π `.jfr` –≤ –Ω–∞—à –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º, –∞ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç—É —Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏, –µ—Å–ª–∏ –æ–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—à–µ–º—É —Ñ–æ—Ä–º–∞—Ç—É. –í–∞–∂–Ω–æ, —á—Ç–æ –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É, –æ–Ω –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∞–π–ª–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:

1. **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî –ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—Ç–æ—è—â–µ–µ –Ω–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—Ç–µ –≤ —Å—Ç—Ä–æ–∫–µ.
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏** ‚Äî —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, —É–∫–∞–∑—ã–≤–∞—é—â–µ–µ, —Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –±—ã–ª–∞ –≤—ã–∑–≤–∞–Ω–∞ –¥–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è.
3. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** ‚Äî –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π.

##### –ü—Ä–∏–º–µ—Ä –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã:

```
# comments
0x80000428              3 additional_info
0x80000464              3
0x80000468              3
0x8000046a              3
this_is_txt_name        9
# comments
0xffffffff80003c10      20
0xffffffff80003c12      20
0xffffffff80003c14      20
0xffffffff80003c16      20
```

##### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**: –°—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `#`, –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º.
- **–î–∞–Ω–Ω—ã–µ –æ –≤—ã–∑–æ–≤–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π**: –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å —á–∏—Å–ª–æ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ—É–Ω–∫—Ü–∏–∏:
  - `0x80000428`, `this_is_txt_name` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏.
  - `3` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
  - –û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `additional_info`) ‚Äî –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏–ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã.

#### –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

–°–∫—Ä–∏–ø—Ç –∫–æ–ø–∏—Ä—É–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ–∞–π–ª—ã –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º –≤ –ø–∞–ø–∫—É `${WORK_DIR}/stages/stage2/`. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π JSON —Ñ–∞–π–ª —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

–ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–æ–≤ –Ω–∞ –≤—ã—Ö–æ–¥–µ:
- `${WORK_DIR}/stages/stage2/histo_0000.histop`
- `${WORK_DIR}/stages/stage2/histo_0000.json`

–§–∞–π–ª JSON –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```json
{
  "type": "reference" | "sample",
  "source_file": "/–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.jfr",
  "histo_file": "/–ø–æ–ª–Ω—ã–π/–ø—É—Ç—å/–∫/—Ñ–∞–π–ª—É.histop"
}
```

–§–∞–π–ª—ã –ø–æ–ª—É—á–∞—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –æ—Ç `0000` –¥–æ `9999`, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.

### üîπ –≠—Ç–∞–ø 3: `solve_math.py`

–°–∫—Ä–∏–ø—Ç —Ä–µ—à–∞–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–¥–∞—á—É –≤—ã–±–æ—Ä–∞ —é–Ω–∏—Ç-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Ö —Å—Ö–æ–∂–µ—Å—Ç–∏ —Å —Ü–µ–ª–µ–≤—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º. –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã –∑–∞–¥–∞—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:

`$MAX_SELECTED_TRACES`: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤. (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `10000`)

`$MIN_SIMILARITY`: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å –¥–ª—è –≤—ã–±–æ—Ä–∞ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤. (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `0`)

–ó–∞–¥–∞—á–∞ –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ç–æ–º, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∫–æ–ª–ª–∏—á–µ—Å—Ç–≤–æ (–Ω–µ –ø—Ä–µ–≤—ã—â–∞—é—â–∏–º `MAX_SELECTED_TRACES`) —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤ —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –≤–µ—Å–∞–º–∏, —á—Ç–æ–±—ã –∏—Ö —Å—Ö–æ–∂–µ—Å—Ç—å —Å —Ü–µ–ª–µ–≤—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º –±—ã–ª–∞ –±–æ–ª—å—à–µ `MIN_SIMILARITY`. 
–í —Å–ª—É—á–∞–µ –Ω–µ–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ–º–æ–π —Å—Ö–æ–∂–µ—Å—Ç–∏ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤, –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞—è —Å—Ö–æ–∂–µ—Å—Ç—å.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª —Å –≤–µ—Å–∞–º–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `${WORK_DIR}/stages/stage3/weight.json`.
–ü—Ä–∏–º–µ—Ä JSON –¥–ª—è –≤–µ—Å–æ–≤:
```json
{
  "selected_unit_tests": [
    {
      "unit_test_path": "/path/to/unit_test_1.jfr",
      "weight": 0.476
    },
    {
      "unit_test_path": "/path/to/unit_test_2.jfr",
      "weight": 0.324
    },
    {
      "unit_test_path": "/path/to/unit_test_3.jfr",
      "weight": 0.200
    }
  ]
}

```

### üîπ –≠—Ç–∞–ø 4: `postprocess.py`

–°–∫—Ä–∏–ø—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ weight.json –∫–æ–ø–∏—Ä—É–µ—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ –∏—Ç–æ–≥–æ–≤—ã–µ –ø–∞–ø–∫–∏. –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –±—É–¥—É—Ç –ª–∏ –∏—Ç–æ–≥–æ–≤—ã–µ –ø–∞–ø–∫–∏ –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–∞–∫–∂–µ –∫–∞–∫ –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ, –∏–ª–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å—Å—è –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º. –†–µ–∂–∏–º—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –ø–∞–ø–æ–∫:

| –†–µ–∂–∏–º             | –û–ø–∏—Å–∞–Ω–∏–µ                                                                 |
|-------------------|--------------------------------------------------------------------------|
| `default`         | –ë–µ–∑ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ JFR.                          |
| `renamed`         | –ü–∞–ø–∫–∏ –±—É–¥—É—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –≤ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç-`selected_trace_0000` |


–§–∞–π–ª—ã –ø–æ–ª—É—á–∞—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –æ—Ç `0000` –¥–æ `9999`, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.
>üí° –≠—Ç–æ—Ç —Ñ–ª–∞–≥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, –±—É–¥—É—Ç –ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã –ø–∞–ø–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏.

## üß™ –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```
application/
‚îú‚îÄ‚îÄ target_workload/
‚îÇ       ‚îî‚îÄ‚îÄ profile.jfr
‚îú‚îÄ‚îÄ unit_test_1/
‚îÇ       ‚îî‚îÄ‚îÄ profile.jfr
‚îú‚îÄ‚îÄ unit_test_2/
‚îÇ       ‚îî‚îÄ‚îÄ profile.jfr
```

## üí° –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∂–∞—Ç–∏—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º
- JSON-—Ñ–æ—Ä–º–∞—Ç—ã –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìß –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: **Timur Ilyinykh**  
Telegram: **@ElfHunterAO**